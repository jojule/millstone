<?xml version="1.0"?>

<project name="Millstone Base Release" default="package">

    <target name="init" unless="version">
    	<fail message="Cannot run this script separately. Run 'build.xml' instead." />    
    </target>


    <target name="checkout" if="release" depends="init">
	<!-- Do the CVS checkout -->
    	<echo message="Checking out MillStone ${version} from ${cvs-root} with tag ${cvs-tag} to ${checkout-dir}" />
	<delete dir="${checkout-dir}/base"/>
	<mkdir dir="${checkout-dir}"/>
	<cvs cvsRoot="${cvs-root}" package="base" tag="${cvs-tag}"
	   dest="${checkout-dir}"/> 	
    </target>
    

    <target name="compile" depends="checkout">
        <mkdir dir="${work-dir}/base"/>
    	<javac srcdir="${root-dir}/base/src" destdir="${work-dir}/base"
	     deprecation="on" optimize="${optimize}"
             classpath="${classpath}" >
	     <include name="org/millstone/base/**"/>
	</javac>
    </target>


    <target name="package" depends="compile"> 
    
        <!-- Create binary JAR -->
        <jar jarfile="${work-dir}/base/${base-bin-jar-name}"
             compress="true"
             manifest="${manifest-dir}/millstone-base-bin.mf">
            <fileset dir="${work-dir}/base">
              <patternset>
                <include name="org/millstone/base/**/*.class"/>
              </patternset>
            </fileset>
        </jar>

	<!-- Copy files to output directory -->
	<copy file="${work-dir}/base/${base-bin-jar-name}" todir="${output-dir}/lib"/>

        <!-- Filtered files -->
	<copy todir="${output-dir}">
	    <filterset>
    	       <filter token="VERSION" value="${version}"/>
            </filterset>
            <fileset dir="${root-dir}">
              <patternset>
                <include name="base/src/**/*.java"/>
                <include name="base/src/**/*.html"/>
              </patternset>
            </fileset>	
	</copy>
	
        <!-- Convert to CRLF's and tabs -->
        <fixcrlf srcdir="${output-dir}/base/src"
                 eol="crlf"
		 tablength="4"
		 tab="remove"
	         includes="**/*.java"/>
	
	
	<!-- Unfiltered files -->
	<copy todir="${output-dir}">
            <fileset dir="${root-dir}">
              <patternset>
                <include name="base/src/**/*.gif"/>
                <include name="base/src/**/*.jpg"/>
                <include name="base/src/**/*.png"/>
              </patternset>
            </fileset>	
	</copy>

        <!-- Create source JAR in output-dir -->
        <jar jarfile="${output-dir}/lib/${base-src-jar-name}"
             compress="true"
             manifest="${manifest-dir}/millstone-base-src.mf">
            <fileset dir="${output-dir}/base/src">
              <patternset>
                <include name="org/millstone/base/**/*.java"/>
              </patternset>
            </fileset>
        </jar>

    </target>

</project>
