<project name="Millstone Webadapter Release" default="package">

    <target name="init" unless="version">
    	<fail message="Cannot run this script separately. Run 'build.xml' instead." />    
    </target>

    <target name="checkout" if="release" depends="init">
	<!-- Do the CVS checkout -->
    	<echo message="Checking out MillStone ${version} from ${cvs-root} with tag ${cvs-tag} to ${checkout-dir}" />
	<delete dir="${checkout-dir}/web-adapter"/>
	<mkdir dir="${checkout-dir}"/>
	<cvs cvsRoot="${cvs-root}" package="web-adapter" tag="${cvs-tag}"
	   dest="${checkout-dir}"/> 	
    </target>    


    <target name="compile" depends="checkout">
        <mkdir dir="${work-dir}/webadapter"/>
    	<javac srcdir="${root-dir}/web-adapter/src" destdir="${work-dir}/webadapter"
	     deprecation="on" optimize="${optimize}"
             classpath="${classpath}:${output-dir}/lib/${base-bin-jar-name}" >
	     <include name="org/millstone/webadapter/**/*.java"/>
	</javac>
    </target>


    <target name="package" depends="compile"> 
    
        <!-- Create binary JAR -->
        <jar jarfile="${work-dir}/webadapter/${webadapter-bin-jar-name}"
             compress="true"
             manifest="${manifest-dir}/millstone-webadapter-bin.mf">
            <fileset dir="${work-dir}/webadapter">
              <patternset>
                <include name="org/millstone/webadapter/**/*.class"/>
              </patternset>
            </fileset>
        </jar>
	
        <!-- Create source JAR -->
        <jar jarfile="${work-dir}/webadapter/${webadapter-src-jar-name}"
             compress="true"
             manifest="${manifest-dir}/millstone-webadapter-src.mf">
            <fileset dir="${root-dir}/web-adapter/src">
              <patternset>
                <include name="org/millstone/webadapter/**/*.java"/>
              </patternset>
            </fileset>
        </jar>	

        <!-- Create themes JAR -->
        <jar jarfile="${work-dir}/webadapter/${web-themes-jar-name}" 
	     compress="false"
	     manifest="${manifest-dir}/millstone-web-themes.mf">
            <fileset dir="${root-dir}/web-adapter/themes">
              <patternset>
                <include name="default/**/*.xsl"/>
                <include name="default/**/*.xml"/>
                <include name="default/**/*.css"/>
                <include name="default/**/*.js"/>
                <include name="default/**/*.gif"/>
                <include name="default/**/*.png"/>
                <include name="default/**/*.jpg"/>
              </patternset>
            </fileset>
	</jar>

	<!-- Copy files to output directory -->
	<copy file="${work-dir}/webadapter/${webadapter-bin-jar-name}" todir="${output-dir}/lib"/>
	<copy file="${work-dir}/webadapter/${webadapter-src-jar-name}" todir="${output-dir}/lib"/>
        <copy file="${work-dir}/webadapter/${web-themes-jar-name}" todir="${output-dir}/lib"/>
	<copy todir="${output-dir}/webthemes">
            <fileset dir="${root-dir}/web-adapter/themes">
              <patternset>
                <include name="default/**/*.xsl"/>
                <include name="default/**/*.xml"/>
                <include name="default/**/*.css"/>
                <include name="default/**/*.js"/>
                <include name="default/**/*.gif"/>
                <include name="default/**/*.png"/>
                <include name="default/**/*.jpg"/>
              </patternset>
            </fileset>
	</copy> 


    </target>

</project>
    
    
    
